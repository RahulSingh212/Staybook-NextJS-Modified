import React from "react";
import { motion, motionValue } from "framer-motion";
import { SubmitHandler, useForm } from "react-hook-form";
import { SocailIcon } from "react-social-icons";
import Link from "next/link";
import Image from "next/image";
import Head from "next/head";
import { USER_ACCESS_TOKEN, extractJWTValues } from "@/lib/helper";
import { useRouter } from "next/router";
import { getUserProfileDetails } from "@/lib/firebase/userHandler";
import { parse } from "cookie";

type Props = {
  userDetails: any;
};

export default function UserProfile(props: Props) {
  const router = useRouter();

  return (
    <React.Fragment>
      <Head>
        <title>StayBook - Profile</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/images/favicon.png" />
      </Head>
      <main className={`w-screen`}>
        <motion.div
          className={`relative flex flex-col w-[90%] mt-10 align-middle mx-auto`}
        >
          <motion.div className={`relative flex w-full mt-3`}>
            <h1 className={`text-3xl font-bold`}>Account</h1>
          </motion.div>
          <div className={`relative flex flex-row mt-2`}>
            <div className={`relative flex font-medium mr-1`}>
              {props.userDetails.User_Display_Name},
            </div>
            <div className={`relative flex font-light`}>
              {props.userDetails.User_Email_Id}.
            </div>
            <div
              onClick={() => {
                router.push({ pathname: "/profile/personal-info" });
              }}
              className={`relative flex underline font-semibold ml-2 cursor-pointer`}
            >
              Go to Profile
            </div>
          </div>
          <motion.div className={`relative flex flex-col w-full mt-5 mb-10 space-y-2`}>
            <motion.div className={`realtive rounded-lg px-5 py-3 shadow-lg`}>
              <div className={``}></div>
            </motion.div>
          </motion.div>
        </motion.div>
      </main>
    </React.Fragment>
  );
}

export async function getServerSideProps(context: any) {
  const { req, res } = context;
  const cookies = parse(req.headers.cookie || "");
  const userAccessToken = cookies[USER_ACCESS_TOKEN];
  const userAccessTokenObject = await extractJWTValues(userAccessToken);
  const userCollectionDoc = await getUserProfileDetails(userAccessTokenObject);
  // console.log(userCollectionDoc);
  return {
    props: {
      userDetails: userCollectionDoc,
    },
  };
}
